package ui;

import classes.Response;
import classes.UserCredentials;
import classes.collection.CollectionManager;
import classes.commands.Info;
import classes.commands.RemoveLower;
import classes.movie.Coordinates;
import classes.movie.Movie;
import classes.sql_managers.SQLManager;
import com.intellij.uiDesigner.core.GridConstraints;
import com.intellij.uiDesigner.core.GridLayoutManager;
import com.intellij.uiDesigner.core.Spacer;
import exceptions.GreatThanException;
import exceptions.NotGreatThanException;
import exceptions.NullValueException;
import ui.locale.Lang;
import ui.locale.NumberCellRenderer;

import javax.swing.*;
import javax.swing.border.TitledBorder;
import javax.swing.plaf.FontUIResource;
import javax.swing.table.*;
import javax.swing.text.StyleContext;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.WindowEvent;
import java.awt.event.WindowListener;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.Locale;

public class MainActivity extends JFrame {
    private JPanel MainActivityPanel;
    private JTable collectionTable;
    private JButton clearCollectionButton;
    private JButton sortASCButton;
    private JButton sortDESCButton;
    private JButton sortButton;
    private JPanel canvasRatingPanel;
    private JButton deleteMovieButton;
    private JButton updateMovieButton;
    private JLabel selectedMovieLabel;
    private JLabel collectionLabel;
    private JPanel tablePanel;
    private JPanel collectionPanel;
    private JPanel movieInformationPanel;
    private JComboBox selectLanguageComboBox;
    private JComboBox selectSortByComboBox;
    private JScrollPane scrollPane;
    private JLabel movieInformationLabel;
    private JPanel userInformationPanel;
    public static UserCredentials credentials;
    private JTabbedPane tabbedPane1;
    private JPanel rightMenuPanel;
    private JPanel tableSettingsPanel;
    private JButton addButton;
    private JPanel sortPanel;
    private JLabel welcomeBackLabel;
    private JButton removeLowerButton;
    private JButton oscarsCountButton;
    private JButton goldenPalmButton;
    private JButton infoButton;
    private JSpinner coordinateYSpinner;
    private JSpinner coordinateXSpinner;
    private Lang lang;
    DefaultTableModel tableModel;
    private final WindowListener tableUpdateListener = new WindowListener() {
        @Override
        public void windowOpened(WindowEvent e) {
        }

        @Override
        public void windowClosing(WindowEvent e) {
        }

        @Override
        public void windowClosed(WindowEvent e) {
            updateTable();
        }

        @Override
        public void windowIconified(WindowEvent e) {

        }

        @Override
        public void windowDeiconified(WindowEvent e) {

        }

        @Override
        public void windowActivated(WindowEvent e) {

        }

        @Override
        public void windowDeactivated(WindowEvent e) {

        }
    };

    public MainActivity(UserCredentials credentials) {
        MainActivity.credentials = credentials;
        $$$setupUI$$$();
        setContentPane(MainActivityPanel);
        setTitle("База данных фильмов");
        setSize(1000, 1200);
        setLocationRelativeTo(null);
        setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);
        setVisible(true);
    }

    public static void main(String[] args) {
        MainActivity mainFrame = new MainActivity(new UserCredentials("anton", "anton"));
    }

    /**
     * Method generated by IntelliJ IDEA GUI Designer
     * >>> IMPORTANT!! <<<
     * DO NOT edit this method OR call it in your code!
     *
     * @noinspection ALL
     */
    private void $$$setupUI$$$() {
        createUIComponents();
        MainActivityPanel = new JPanel();
        MainActivityPanel.setLayout(new GridLayoutManager(1, 1, new Insets(0, 0, 0, 0), -1, -1));
        MainActivityPanel.setBackground(new Color(-1));
        MainActivityPanel.setForeground(new Color(-16729671));
        tabbedPane1 = new JTabbedPane();
        tabbedPane1.setBackground(new Color(-16729671));
        tabbedPane1.setFocusable(false);
        tabbedPane1.setForeground(new Color(-1));
        tabbedPane1.setRequestFocusEnabled(false);
        MainActivityPanel.add(tabbedPane1, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, new Dimension(200, 200), null, 0, false));
        final JPanel panel1 = new JPanel();
        panel1.setLayout(new GridLayoutManager(2, 1, new Insets(0, 0, 0, 0), -1, -1));
        tabbedPane1.addTab("Main", panel1);
        collectionPanel = new JPanel();
        collectionPanel.setLayout(new GridLayoutManager(2, 2, new Insets(10, 10, 10, 10), -1, -1));
        collectionPanel.setBackground(new Color(-16729671));
        panel1.add(collectionPanel, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_WANT_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, null, null, 0, false));
        tablePanel = new JPanel();
        tablePanel.setLayout(new GridLayoutManager(1, 1, new Insets(0, 0, 0, 0), -1, -1));
        tablePanel.setOpaque(false);
        tablePanel.setRequestFocusEnabled(false);
        tablePanel.setVerifyInputWhenFocusTarget(false);
        collectionPanel.add(tablePanel, new GridConstraints(1, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, null, null, 0, false));
        scrollPane.setBackground(new Color(-16729671));
        scrollPane.setDoubleBuffered(true);
        scrollPane.setEnabled(true);
        scrollPane.setForeground(new Color(-16729671));
        tablePanel.add(scrollPane, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_FIXED, 1, null, null, null, 0, false));
        collectionTable.setAutoResizeMode(1);
        collectionTable.setBackground(new Color(-1));
        collectionTable.setCellSelectionEnabled(false);
        collectionTable.setColumnSelectionAllowed(false);
        collectionTable.setDoubleBuffered(false);
        collectionTable.setEditingColumn(1);
        collectionTable.setEditingRow(1);
        collectionTable.setEnabled(true);
        collectionTable.setRowSelectionAllowed(true);
        collectionTable.setSurrendersFocusOnKeystroke(true);
        collectionTable.setToolTipText("meow meow");
        scrollPane.setViewportView(collectionTable);
        userInformationPanel = new JPanel();
        userInformationPanel.setLayout(new GridLayoutManager(1, 4, new Insets(0, 0, 0, 0), -1, -1));
        userInformationPanel.setBackground(new Color(-16729671));
        userInformationPanel.setFocusable(false);
        userInformationPanel.setForeground(new Color(-1));
        collectionPanel.add(userInformationPanel, new GridConstraints(0, 0, 1, 2, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, 1, 1, null, null, null, 0, false));
        welcomeBackLabel.setBackground(new Color(-16729671));
        welcomeBackLabel.setForeground(new Color(-1));
        userInformationPanel.add(welcomeBackLabel, new GridConstraints(0, 2, 1, 1, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_NONE, 1, 1, null, null, null, 0, false));
        final Spacer spacer1 = new Spacer();
        userInformationPanel.add(spacer1, new GridConstraints(0, 1, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_HORIZONTAL, GridConstraints.SIZEPOLICY_WANT_GROW, 1, null, null, null, 0, false));
        collectionLabel.setBackground(new Color(-16729671));
        collectionLabel.setFocusable(true);
        collectionLabel.setForeground(new Color(-1));
        userInformationPanel.add(collectionLabel, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_NONE, 1, 1, null, null, null, 0, false));
        selectLanguageComboBox.setBackground(new Color(-16729671));
        selectLanguageComboBox.setEditable(false);
        selectLanguageComboBox.setForeground(new Color(-1));
        selectLanguageComboBox.setLightWeightPopupEnabled(false);
        userInformationPanel.add(selectLanguageComboBox, new GridConstraints(0, 3, 1, 1, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_FIXED, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
        rightMenuPanel = new JPanel();
        rightMenuPanel.setLayout(new GridLayoutManager(1, 1, new Insets(0, 0, 0, 0), -1, -1));
        rightMenuPanel.setBackground(new Color(-16729671));
        collectionPanel.add(rightMenuPanel, new GridConstraints(1, 1, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, 1, 1, null, null, null, 0, false));
        tableSettingsPanel = new JPanel();
        tableSettingsPanel.setLayout(new GridLayoutManager(10, 1, new Insets(0, 0, 0, 0), -1, -1));
        tableSettingsPanel.setBackground(new Color(-16729671));
        rightMenuPanel.add(tableSettingsPanel, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_NORTH, GridConstraints.FILL_HORIZONTAL, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, null, null, 0, false));
        sortPanel = new JPanel();
        sortPanel.setLayout(new GridLayoutManager(2, 2, new Insets(0, 0, 0, 0), -1, -1));
        sortPanel.setBackground(new Color(-16729671));
        sortPanel.setForeground(new Color(-1));
        sortPanel.setName("Sort");
        tableSettingsPanel.add(sortPanel, new GridConstraints(9, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, 1, 1, null, null, null, 0, false));
        sortPanel.setBorder(BorderFactory.createTitledBorder(BorderFactory.createLineBorder(new Color(-1)), "Сортировать по", TitledBorder.DEFAULT_JUSTIFICATION, TitledBorder.DEFAULT_POSITION, null, new Color(-1)));
        sortASCButton.setBackground(new Color(-1));
        sortASCButton.setFocusable(false);
        Font sortASCButtonFont = this.$$$getFont$$$(null, -1, 20, sortASCButton.getFont());
        if (sortASCButtonFont != null) sortASCButton.setFont(sortASCButtonFont);
        sortASCButton.setForeground(new Color(-16729671));
        sortASCButton.setHideActionText(true);
        sortASCButton.setText("↓");
        sortPanel.add(sortASCButton, new GridConstraints(1, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_FIXED, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
        sortDESCButton.setBackground(new Color(-1));
        sortDESCButton.setFocusable(false);
        Font sortDESCButtonFont = this.$$$getFont$$$(null, -1, 20, sortDESCButton.getFont());
        if (sortDESCButtonFont != null) sortDESCButton.setFont(sortDESCButtonFont);
        sortDESCButton.setForeground(new Color(-16729671));
        sortDESCButton.setText("↑");
        sortPanel.add(sortDESCButton, new GridConstraints(1, 1, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_FIXED, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
        selectSortByComboBox.setBackground(new Color(-1));
        selectSortByComboBox.setForeground(new Color(-16729671));
        sortPanel.add(selectSortByComboBox, new GridConstraints(0, 0, 1, 2, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
        addButton.setBackground(new Color(-1));
        addButton.setBorderPainted(true);
        addButton.setFocusPainted(true);
        addButton.setFocusable(false);
        addButton.setForeground(new Color(-16729671));
        addButton.setHideActionText(false);
        addButton.setText("Add movie");
        tableSettingsPanel.add(addButton, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
        clearCollectionButton.setBackground(new Color(-1));
        clearCollectionButton.setFocusable(false);
        clearCollectionButton.setForeground(new Color(-16729671));
        clearCollectionButton.setText("Clear");
        tableSettingsPanel.add(clearCollectionButton, new GridConstraints(8, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, 1, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
        oscarsCountButton = new JButton();
        oscarsCountButton.setBackground(new Color(-1));
        oscarsCountButton.setFocusable(false);
        oscarsCountButton.setForeground(new Color(-16729671));
        oscarsCountButton.setText("Count by Oscars count");
        tableSettingsPanel.add(oscarsCountButton, new GridConstraints(5, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
        goldenPalmButton = new JButton();
        goldenPalmButton.setBackground(new Color(-1));
        goldenPalmButton.setFocusable(false);
        goldenPalmButton.setForeground(new Color(-16729671));
        goldenPalmButton.setText("Count by Golden palm count");
        tableSettingsPanel.add(goldenPalmButton, new GridConstraints(6, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
        infoButton.setBackground(new Color(-1));
        infoButton.setFocusable(false);
        infoButton.setForeground(new Color(-16729671));
        infoButton.setText("Info");
        tableSettingsPanel.add(infoButton, new GridConstraints(7, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
        updateMovieButton.setBackground(new Color(-1));
        updateMovieButton.setFocusable(false);
        updateMovieButton.setForeground(new Color(-16729671));
        updateMovieButton.setHideActionText(false);
        updateMovieButton.setHorizontalTextPosition(0);
        updateMovieButton.setText("Update movie");
        updateMovieButton.setToolTipText("");
        tableSettingsPanel.add(updateMovieButton, new GridConstraints(1, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_WANT_GROW, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
        deleteMovieButton.setBackground(new Color(-1));
        deleteMovieButton.setFocusPainted(true);
        deleteMovieButton.setFocusable(false);
        deleteMovieButton.setForeground(new Color(-16729671));
        deleteMovieButton.setInheritsPopupMenu(false);
        deleteMovieButton.setLabel("Delete movie");
        deleteMovieButton.setText("Delete movie");
        tableSettingsPanel.add(deleteMovieButton, new GridConstraints(2, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_FIXED, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
        final JPanel panel2 = new JPanel();
        panel2.setLayout(new GridLayoutManager(2, 1, new Insets(0, 0, 0, 0), -1, -1));
        panel2.setBackground(new Color(-16729671));
        tableSettingsPanel.add(panel2, new GridConstraints(4, 0, 1, 1, GridConstraints.ANCHOR_NORTH, GridConstraints.FILL_HORIZONTAL, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, null, null, 0, false));
        panel2.setBorder(BorderFactory.createTitledBorder(BorderFactory.createLineBorder(Color.black), null, TitledBorder.DEFAULT_JUSTIFICATION, TitledBorder.DEFAULT_POSITION, null, new Color(-1)));
        final JPanel panel3 = new JPanel();
        panel3.setLayout(new GridLayoutManager(2, 2, new Insets(0, 0, 0, 0), -1, -1));
        panel3.setBackground(new Color(-16729671));
        panel2.add(panel3, new GridConstraints(1, 0, 1, 1, GridConstraints.ANCHOR_NORTH, GridConstraints.FILL_NONE, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, null, null, null, 0, false));
        coordinateYSpinner.setBackground(new Color(-1));
        coordinateYSpinner.setForeground(new Color(-16729671));
        coordinateYSpinner.setRequestFocusEnabled(false);
        panel3.add(coordinateYSpinner, new GridConstraints(1, 1, 1, 1, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_NONE, GridConstraints.SIZEPOLICY_WANT_GROW, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
        coordinateXSpinner.setBackground(new Color(-1));
        coordinateXSpinner.setForeground(new Color(-16729671));
        coordinateXSpinner.setRequestFocusEnabled(false);
        panel3.add(coordinateXSpinner, new GridConstraints(0, 1, 1, 1, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_NONE, GridConstraints.SIZEPOLICY_WANT_GROW, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
        final JLabel label1 = new JLabel();
        label1.setForeground(new Color(-1));
        label1.setText("X");
        panel3.add(label1, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_EAST, GridConstraints.FILL_NONE, GridConstraints.SIZEPOLICY_FIXED, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
        final JLabel label2 = new JLabel();
        label2.setForeground(new Color(-1));
        label2.setText("Y");
        panel3.add(label2, new GridConstraints(1, 0, 1, 1, GridConstraints.ANCHOR_EAST, GridConstraints.FILL_NONE, GridConstraints.SIZEPOLICY_FIXED, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
        removeLowerButton.setAutoscrolls(false);
        removeLowerButton.setBackground(new Color(-1));
        removeLowerButton.setFocusable(false);
        removeLowerButton.setForeground(new Color(-16729671));
        removeLowerButton.setText("Remove lower");
        panel2.add(removeLowerButton, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
        final JPanel panel4 = new JPanel();
        panel4.setLayout(new GridLayoutManager(3, 2, new Insets(0, 0, 0, 0), -1, -1));
        tabbedPane1.addTab("Statistics", panel4);
        canvasRatingPanel = new JPanel();
        canvasRatingPanel.setLayout(new GridLayoutManager(1, 1, new Insets(0, 0, 0, 0), -1, -1));
        canvasRatingPanel.setAutoscrolls(false);
        canvasRatingPanel.setBackground(new Color(-1976857));
        canvasRatingPanel.setForeground(new Color(-4489393));
        panel4.add(canvasRatingPanel, new GridConstraints(0, 0, 3, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_GROW, null, null, null, 0, false));
        canvasRatingPanel.setBorder(BorderFactory.createTitledBorder(null, "Рейтинг фильмов", TitledBorder.DEFAULT_JUSTIFICATION, TitledBorder.DEFAULT_POSITION, null, null));
        movieInformationPanel.setLayout(new GridLayoutManager(1, 1, new Insets(0, 0, 0, 0), -1, -1));
        panel4.add(movieInformationPanel, new GridConstraints(1, 1, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_BOTH, GridConstraints.SIZEPOLICY_CAN_SHRINK | GridConstraints.SIZEPOLICY_CAN_GROW, GridConstraints.SIZEPOLICY_CAN_GROW, null, null, null, 0, false));
        movieInformationPanel.setBorder(BorderFactory.createTitledBorder(null, "Дополнительная информация", TitledBorder.DEFAULT_JUSTIFICATION, TitledBorder.DEFAULT_POSITION, null, null));
        movieInformationLabel.setText("Label");
        movieInformationPanel.add(movieInformationLabel, new GridConstraints(0, 0, 1, 1, GridConstraints.ANCHOR_WEST, GridConstraints.FILL_NONE, GridConstraints.SIZEPOLICY_FIXED, GridConstraints.SIZEPOLICY_FIXED, null, null, null, 0, false));
        final Spacer spacer2 = new Spacer();
        panel4.add(spacer2, new GridConstraints(0, 1, 1, 1, GridConstraints.ANCHOR_CENTER, GridConstraints.FILL_VERTICAL, 1, GridConstraints.SIZEPOLICY_WANT_GROW, null, null, null, 0, false));
    }

    /**
     * @noinspection ALL
     */
    private Font $$$getFont$$$(String fontName, int style, int size, Font currentFont) {
        if (currentFont == null) return null;
        String resultName;
        if (fontName == null) {
            resultName = currentFont.getName();
        } else {
            Font testFont = new Font(fontName, Font.PLAIN, 10);
            if (testFont.canDisplay('a') && testFont.canDisplay('1')) {
                resultName = fontName;
            } else {
                resultName = currentFont.getName();
            }
        }
        Font font = new Font(resultName, style >= 0 ? style : currentFont.getStyle(), size >= 0 ? size : currentFont.getSize());
        boolean isMac = System.getProperty("os.name", "").toLowerCase(Locale.ENGLISH).startsWith("mac");
        Font fontWithFallback = isMac ? new Font(font.getFamily(), font.getStyle(), font.getSize()) : new StyleContext().getFont(font.getFamily(), font.getStyle(), font.getSize());
        return fontWithFallback instanceof FontUIResource ? fontWithFallback : new FontUIResource(fontWithFallback);
    }

    /**
     * @noinspection ALL
     */
    public JComponent $$$getRootComponent$$$() {
        return MainActivityPanel;
    }

    private void createUIComponents() {
        lang = new Lang();
        componentsInitialization();

        selectLanguageComboBox.addActionListener(e -> {
            lang.setLanguage(selectLanguageComboBox.getSelectedIndex());
            changeComponentsLanguage();
        });

        sortDESCButton.addActionListener(this::descButtonSortClicked);
        sortASCButton.addActionListener(this::ascButtonSortClicked);

        collectionTable = getCollectionTable();

        addButton = new JButton();
        addButton.addActionListener((ActionEvent e) -> {
            AddPopup addPopup = new AddPopup();
            addPopup.addWindowListener(tableUpdateListener);
        });

        infoButton = new JButton();
        infoButton.addActionListener(this::infoButtonClicked);

        updateMovieButton = new JButton();
        updateMovieButton.addActionListener(this::updateMovieClicked);

        deleteMovieButton = new JButton();
        deleteMovieButton.addActionListener(this::deleteMovieClicked);

        removeLowerButton = new JButton();
        removeLowerButton.addActionListener(this::removeLowerClicked);

        coordinateXSpinner = new JSpinner(new SpinnerNumberModel(0, null, 279, 1));
        coordinateYSpinner = new JSpinner(new SpinnerNumberModel(0, -279, null, 1));
    }

    private void removeLowerClicked(ActionEvent e) {
        Coordinates coordinates;
        try {
            coordinates = new Coordinates(
                    (int) coordinateXSpinner.getValue(),
                    (int) coordinateYSpinner.getValue()
            );
            String[] coordinatesArray = {String.valueOf(coordinates.getX()), String.valueOf(coordinates.getY())};
            Response response = new RemoveLower().execute(coordinatesArray, credentials.getUsername());
            if (response.getCode() == 0) {
                new InfoPopup("Удаление фильмов меньше " + coordinates, "Фильмы удалены успешно", new Color(0, 80, 0), 400, 200);
                updateTable();
            } else new InfoPopup("Ошибка", (String) response.getData(), new Color(0xBB0000), 600, 200);
        } catch (NotGreatThanException ex) {
            new InfoPopup("Ошибка", "Координата Y должна быть больше -230", new Color(0xBB0000), 600, 200);
        } catch (NullValueException ex) {
            new InfoPopup("Ошибка", "Координаты не могут быть пустыми", new Color(0xBB0000), 600, 200);
        } catch (GreatThanException ex) {
            new InfoPopup("Ошибка", "Координата X не может быть больше 279", new Color(0xBB0000), 600, 200);
        }
    }

    private void deleteMovieClicked(ActionEvent e) {
        int selectedRowId = collectionTable.getSelectedRow();
        if (selectedRowId == -1)
            new InfoPopup(
                    "Ошибка",
                    "Выделите фильм для удаления",
                    new Color(187, 0, 0),
                    500, 200);
        else {
            Movie deletingMovie = new CollectionManager().getCollection().get(selectedRowId);
            if (deletingMovie.getUserID().equals(credentials.getUsername())) {
                SQLManager.executeDeleteMovie(deletingMovie.getId(), credentials.getUsername());
                new InfoPopup("Удаление фильма", "Фильм успешно удалён", new Color(0, 80, 0), 400, 200);
                updateTable();
            } else new InfoPopup(
                    "Ошибка доступа",
                    "Вы не можете удалять фильмы пользователя " + deletingMovie.getUserID(),
                    new Color(187, 0, 0),
                    600, 200);
        }
    }

    private void updateMovieClicked(ActionEvent e) {
        int selectedRowId = collectionTable.getSelectedRow();
        if (selectedRowId == -1)
            new InfoPopup(
                    "Ошибка",
                    "Выделите фильм для изменения",
                    new Color(187, 0, 0),
                    500, 200);
        else {
            Movie updatingMovie = new CollectionManager().getCollection().get(selectedRowId);
            if (updatingMovie.getUserID().equals(credentials.getUsername())) {
                new UpdatePopup(updatingMovie);
                updateTable();
            } else new InfoPopup(
                    "Ошибка доступа",
                    "Вы не можете изменять фильмы пользователя " + updatingMovie.getUserID(),
                    new Color(187, 0, 0),
                    600, 200);
        }
    }

    private void infoButtonClicked(ActionEvent e) {
        String info = (String) new Info().execute(null, credentials.getUsername()).getData();
        info = "<html><p style=\"white-space: nowrap; font-size: 14px;\">" + info.replace("\n", "<br>") + "</p></html>";
        new InfoPopup("Информация о коллекции", info, new Color(39, 169, 169), 600, 300);
    }

    private void componentsInitialization() {
        welcomeBackLabel = new JLabel(lang.getString("hello_user") + credentials.getUsername());
        clearCollectionButton = new JButton(lang.getString("clear_collection_button"));
        sortButton = new JButton(lang.getString("sort_collection_button"));
        sortDESCButton = new JButton();
        sortASCButton = new JButton();
        selectLanguageComboBox = getLanguageIconComboBox();
        deleteMovieButton = new JButton(lang.getString("remove_collection_button"));
        updateMovieButton = new JButton(lang.getString("update_movie_button"));
        selectedMovieLabel = new JLabel(lang.getString("chosen_movie_label"));
        collectionLabel = new JLabel(lang.getString("collection_label"));
        movieInformationLabel = new JLabel();
        movieInformationPanel = new JPanel();
        selectSortByComboBox = getSortByComboBox();
        movieInformationPanel.setBorder(BorderFactory.createTitledBorder(BorderFactory.createLineBorder(new Color(-12743731)), lang.getString("movie_information_label")));
        movieInformationLabel = new JLabel("Здесь будет информация о фильме");
    }

    private void changeComponentsLanguage() {
        welcomeBackLabel.setText(lang.getString("hello_user") + credentials.getUsername());
        clearCollectionButton.setText((lang.getString("clear_collection_button")));
        sortButton.setText((lang.getString("sort_collection_button")));
        deleteMovieButton.setText((lang.getString("remove_collection_button")));
        updateMovieButton.setText((lang.getString("update_movie_button")));
        selectedMovieLabel.setText((lang.getString("chosen_movie_label")));
        collectionLabel.setText((lang.getString("collection_label")));
        selectSortByComboBox.setModel(getNewLanguageTableColumnsComboBoxModel());
        collectionTable.setColumnModel(getNewLanguageColumnModel());
        collectionTable.setDefaultRenderer(Date.class, new DateCellRenderer(lang.getCurrentLocale()));
        collectionTable.setDefaultRenderer(Integer.class, new NumberCellRenderer(lang.getCurrentLocale()));
    }

    public void updateTable() {
        CollectionManager collectionManager = new CollectionManager();
        collectionManager.renderMainJTable();
        Object[][] data = collectionManager.getTableContent();
        tableModel = new DefaultTableModel(data, lang.getTableColumns()) {
            @Override
            public Class<?> getColumnClass(int columnIndex) {
                if (collectionManager.getCollection().isEmpty()) {
                    return Object.class;
                }
                return CollectionManager.getColumnsClasses().get(columnIndex);
            }
        };
        collectionTable.revalidate();
        collectionTable.setModel(tableModel);
        tableModel.fireTableDataChanged();
    }

    private JTable getCollectionTable() {
        CollectionManager.readDB();
        CollectionManager collectionManager = new CollectionManager();
        collectionManager.renderMainJTable();
        Object[][] data = collectionManager.getTableContent();
        tableModel = new DefaultTableModel(data, lang.getTableColumns()) {

            @Override
            public Class<?> getColumnClass(int columnIndex) {
                if (collectionManager.getCollection().isEmpty()) {
                    return Object.class;
                }
                return CollectionManager.getColumnsClasses().get(columnIndex);
            }
        };
        JTable table = new JTable(tableModel) {
            public boolean isCellEditable(int row, int column) {
                return false;
            }
        };
        table.setAutoCreateRowSorter(true);
        table.getColumnModel().getColumn(2).setCellRenderer(new DateCellRenderer(lang.getCurrentLocale()));
        table.setDefaultRenderer(Integer.class, new NumberCellRenderer(lang.getCurrentLocale()));
        scrollPane = new JScrollPane(table);
        scrollPane.setHorizontalScrollBarPolicy(JScrollPane.HORIZONTAL_SCROLLBAR_ALWAYS);
        scrollPane.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_ALWAYS);
        table.setBounds(10, 20, 150, 100);
        getContentPane().add(scrollPane);
        table.setCellSelectionEnabled(true);
        ListSelectionModel select = table.getSelectionModel();
        select.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
        return table;
    }

    private void descButtonSortClicked(ActionEvent e) {

        int columnIndexSortBy = selectSortByComboBox.getSelectedIndex();

        TableRowSorter<TableModel> sorter = new TableRowSorter<>(collectionTable.getModel());
        collectionTable.setRowSorter(sorter);
        List<RowSorter.SortKey> sortKeys = new ArrayList<>(1);
        sortKeys.add(new RowSorter.SortKey(columnIndexSortBy, SortOrder.DESCENDING));
        sorter.setSortKeys(sortKeys);
        sorter.sort();
    }

    private void ascButtonSortClicked(ActionEvent e) {

        int columnIndexSortBy = selectSortByComboBox.getSelectedIndex();

        TableRowSorter<TableModel> sorter = new TableRowSorter<>(collectionTable.getModel());
        collectionTable.setRowSorter(sorter);
        List<RowSorter.SortKey> sortKeys = new ArrayList<>(1);
        sortKeys.add(new RowSorter.SortKey(columnIndexSortBy, SortOrder.ASCENDING));
        sorter.setSortKeys(sortKeys);
        sorter.sort();
    }

    private JComboBox<Icon> getLanguageIconComboBox() {
        List<Icon> iconList = new ArrayList<>() {{
            add(new ImageIcon(getClass().getResource("/images/canada_flag.png")));
            add(new ImageIcon(getClass().getResource("/images/russia_flag.png")));
            add(new ImageIcon(getClass().getResource("/images/belorussia_flag.png")));
            add(new ImageIcon(getClass().getResource("/images/hungarian_flag.png")));
        }};
        DefaultComboBoxModel<Icon> comboBoxModel = new DefaultComboBoxModel<>();
        comboBoxModel.addAll(iconList);
        JComboBox<Icon> comboBox = new JComboBox<>(comboBoxModel);
        comboBox.setSelectedIndex(lang.getCurrentLocaleIndex());
        comboBox.setPreferredSize(new Dimension(50, 60));
        return comboBox;
    }

    private JComboBox<String> getSortByComboBox() {
        DefaultComboBoxModel<String> comboBoxModel = getNewLanguageTableColumnsComboBoxModel();
        JComboBox<String> comboBox = new JComboBox<>(comboBoxModel);
        comboBox.setSelectedIndex(0);
        return comboBox;
    }

    private DefaultComboBoxModel<String> getNewLanguageTableColumnsComboBoxModel() {
        return new DefaultComboBoxModel<>(lang.getTableColumns());
    }


    private DefaultTableColumnModel getNewLanguageColumnModel() {
        DefaultTableColumnModel columnModel = new DefaultTableColumnModel();
        for (int i = 0; i < lang.getTableColumns().length; i++) {
            TableColumn tableColumn = new TableColumn(i);
            tableColumn.setHeaderValue(lang.getTableColumns()[i]);
            columnModel.addColumn(tableColumn);
        }
        return columnModel;
    }
}
